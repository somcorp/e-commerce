name: Notify Discord on commit
on:
  push:
    branches: [master]

jobs:
  discord_notify:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar pro Discord
        run: |
          SHA="${{ github.sha }}"
          SHORT_SHA="${SHA::7}"
          ACTOR="${{ github.actor }}"
          REPO="${{ github.repository }}"
          MSG="${{ github.event.head_commit.message }}"
          URL="https://github.com/${REPO}/commit/${SHA}"

          CONTENT="üü¢ **${REPO}**
          üë§ ${ACTOR}
          üìù ${MSG}
          üîó ${URL}
          #Ô∏è‚É£ ${SHORT_SHA}"

          jq -n --arg c "$CONTENT" '{content:$c}' \
            | curl -sS -H "Content-Type: application/json" -d @- "$DISCORD_WEBHOOK_URL"
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
